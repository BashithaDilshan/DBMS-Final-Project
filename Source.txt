//Full Source code Here


//All table Structures Here

create table user(
    user_id char(8) not null primary key,
    F_name varchar(100) not null,
    L_name varchar(100) not null,
    Address varchar(100) not null,
    phone_number int not null,
    dob date not null,
    email varchar(100) not null,
    gender ENUM('M', 'F') NOT NULL
);

create table admin(
    user_id char(8) not null primary key,
    appointment_of_date date not null,
    Access_level varchar(50) not null,
    status ENUM('ACTIVE', 'INACTIVE', 'RETIRED', 'TRANSFERRED', 'TERMINATED') NOT NULL DEFAULT 'ACTIVE',
    foreign key(user_id) references user(user_id)

);

create table dean(
    user_id char(8) not null primary key,
    appointment_of_date date not null,
    status ENUM('ACTIVE', 'INACTIVE', 'RETIRED', 'TRANSFERRED', 'TERMINATED') NOT NULL DEFAULT 'ACTIVE',
    foreign key(user_id) references user(user_id)
);

create table tos(
    user_id char(8) not null primary key,
    appointment_of_date date not null,
    status ENUM('ACTIVE', 'INACTIVE', 'RETIRED', 'TRANSFERRED', 'TERMINATED') NOT NULL DEFAULT 'ACTIVE',
    Duty_of_Area varchar(100) not null,
    position varchar(100) not null,
    shift_time time not null,
    foreign key(user_id) references user(user_id)
);


create table lecture(
    user_id char(8) not null primary key,
    appointment_of_date date not null,
    status ENUM('ACTIVE', 'INACTIVE', 'RETIRED', 'TRANSFERRED', 'TERMINATED') NOT NULL DEFAULT 'ACTIVE',
    position varchar(100) not null,
    foreign key(user_id) references user(user_id)
);

create table student(
    Reg_no char(8) not null primary key,
    status ENUM('PROPER', 'REPEAT', 'SUSPENDED') NOT NULL DEFAULT 'PROPER',
    session_id varchar(8),
    b_id varchar(8),
    m_id varchar(8),
    foreign key(Reg_no) references user(user_id),
    foreign key(session_id) references timetable(session_id),
    foreign key(b_id) references batch(b_id),
    foreign key(m_id) references marks(m_id)

);

create table batch(
    b_id char(8) not null primary key,
    b_name varchar(100) not null,
    acedemic_year year not null,
    start_date date not null,
    end_date date not null
);

create table department(
    dept_id char(8) not null primary key,
    d_name varchar(100) not null
);

create table course_unit(
    c_code char(8) not null primary key,
    c_name varchar(50) not null,
    credit int not null,
    is_theory ENUM('YES', 'NO') NOT NULL DEFAULT 'YES',
    is_practicel ENUM('YES', 'NO') NOT NULL DEFAULT 'YES',
    semester char(3) not null
);

create table marks(
    m_id varchar(8) not null primary key,
    Entered_date date not null
);

create table Assesment_marks(
    m_id varchar(8) not null primary key,
    is_CA ENUM('YES', 'NO') NOT NULL DEFAULT 'YES',
    Assesment_marks decimal(5,2) not null,
    foreign key(m_id) references marks(m_id),
    CHECK (Assesment_marks >= 0 AND Assesment_marks <= 100)
);

create table mid_masks(
    m_id varchar(8) not null primary key,
    is_CA ENUM('YES', 'NO') NOT NULL DEFAULT 'YES',
    theory decimal(5,2) not null,
    practical decimal(5,2) not null,
    foreign key(m_id) references marks(m_id),
    CHECK (practical >= 0 AND practical <= 100),
    CHECK (theory >= 0 AND theory <= 100)
);

create table end_marks(
     m_id varchar(8) not null primary key,
     theory decimal(5,2) not null,
    practical decimal(5,2) not null,
    foreign key(m_id) references marks(m_id),
    CHECK (practical >= 0 AND practical <= 100),
    CHECK (theory >= 0 AND theory <= 100)
);

create  table timetable(
    session_id varchar(8) not null primary key,
    session_no int not null,
    session_date date not null,
    type ENUM('PRACTICAL', 'THEORY') NOT NULL DEFAULT 'THEORY',
    duration time not null,
    lec_hall varchar(10) not null,
    c_code varchar(8)
);

create table medical(
    medical_id varchar(8) not null primary key,
    submission_date date not null,
    description text not null,
    affectted_start_date date not null,
    affectted_end_date date not null,
    status ENUM('approved', 'not approved') NOT NULL DEFAULT 'not approved',
    Reg_no varchar(8),
    session_id varchar(8),
    foreign key(Reg_no) references student(Reg_no),
    foreign key(session_id) references timetable(session_id)

);

create table attendence(
    att_id varchar(8) not null primary key,
    type ENUM("theory","practical")  NOT NULL DEFAULT 'theory',
    atten_date date not null,
    status ENUM("absent","Present")  NOT NULL DEFAULT 'Present',
    Reg_no varchar(8) ,
    session_id varchar(8),
    foreign key(Reg_no) references student(Reg_no),
    foreign key(session_id) references timetable(session_id)
);

create table entroll(
    Reg_no varchar(8) not null,
    c_code varchar(8) not null,
    entroll_date date not null,
    foreign key(Reg_no) references student(Reg_no),
    foreign key(c_code) references course_unit(c_code)
);

create table lecturing(
    user_id varchar(8) not null,
    c_code varchar(8) not null,
    foreign key(user_id) references lecture(user_id),
    foreign key(c_code) references course_unit(c_code)
);

create table keep(
    Reg_no varchar(8) not null,
    m_id varchar(8) not null,
    foreign key(Reg_no) references student(Reg_no),
    foreign key(m_id) references marks(m_id)

);

//All Table Changes Here

alter table user
add column dept_id varchar(8);

alter table user 
add foreign key(dept_id) references department(dept_id);

alter table course_unit 
add column m_id char(8);

alter table course_unit 
add foreign key(m_id) references marks(m_id);

alter table marks 
add column Reg_no char(8);

alter table marks 
add foreign key(Reg_no) references student(Reg_no);

alter table timetable 
add column Reg_no char(8);

alter table lecture 
add foreign key(user_id) references user(user_id);

alter table timetable 
add foreign key(c_code) references course_unit(c_code);

alter table user
add column dept_id char(8);

alter table user
add foreign key(dept_id) references department(dept_id);

//User table Data here

INSERT INTO user (user_id, F_name, L_name, Address, phone_number, dob, email, gender, dept_id) VALUES
('TCH/1001','Kavindu','Perera','Colombo 05',771000001,'2000-01-15','kavindu.perera@example.com','M','D001'),
('TCH/1002','Nimesha','Silva','Galle',771000002,'1999-05-20','nimesha.silva@example.com','F','D001'),
('TCH/1003','Isuru','Wijesinghe','Kandy',771000003,'2001-03-12','isuru.wije@example.com','M','D001'),
('TCH/1004','Sanduni','Fernando','Matara',771000004,'1998-07-25','sanduni.fernando@example.com','F','D001'),
('TCH/1005','Ravindu','Jayasinghe','Kurunegala',771000005,'2000-11-18','ravindu.jaya@example.com','M','D001'),
('TCH/1006','Tharushi','Karunaratne','Negombo',771000006,'1999-09-05','tharushi.karu@example.com','F','D001'),
('TCH/1007','Sahan','Dissanayake','Kegalle',771000007,'2001-06-22','sahan.dissa@example.com','M','D001'),
('TCH/1008','Imasha','Ekanayake','Anuradhapura',771000008,'2000-02-14','imasha.eka@example.com','F','D001'),
('TCH/1009','Chathura','Bandara','Badulla',771000009,'1999-12-30','chathura.bandara@example.com','M','D001'),
('TCH/1010','Dilushi','Ratnayake','Gampaha',771000010,'2000-08-08','dilushi.ratna@example.com','F','D001'),
('TCH/1011','Kaveeshan','Kumara','Hambantota',771000011,'2001-01-05','kaveeshan.kumara@example.com','M','D001'),
('TCH/1012','Shenali','Gunasekara','Kalutara',771000012,'1999-04-11','shenali.guna@example.com','F','D001'),
('TCH/1013','Pasindu','Abeywickrama','Trincomalee',771000013,'2000-06-30','pasindu.abey@example.com','M','D001'),
('TCH/1014','Nethmi','Weerasinghe','Monaragala',771000014,'1998-10-17','nethmi.weera@example.com','F','D001'),
('TCH/1015','Sewwandi','Peris','Ratnapura',771000015,'2001-02-28','sewwandi.peris@example.com','F','D001'),
('TCH/1016','Kasun','De Silva','Colombo 07',771000016,'1999-07-13','kasun.desilva@example.com','M','D001'),
('TCH/1017','Shenal','Jayawardena','Galle',771000017,'2000-05-21','shenal.jaya@example.com','M','D001'),
('TCH/1018','Hansika','Pathirana','Kandy',771000018,'1998-11-09','hansika.pathi@example.com','F','D001'),
('TCH/1019','Dinuka','Rajapaksha','Jaffna',771000019,'2001-03-03','dinuka.rajapaksha@example.com','M','D001'),
('TCH/1020','Thisara','Madushanka','Kurunegala',771000020,'1999-12-22','thisara.madu@example.com','M','D001');

// Department Data add Here

INSERT INTO department (dept_id, d_name) VALUES
('D001', 'Information Communication Technology'),
('D002', 'Engineering Technology'),
('D003', 'Biosystem Technology'),
('D004', 'Multidispinary');
('D001', 'Information Communication Technology'),
('D002', 'Engineering Technology'),
('D003', 'Biosystem Technology'),
('D004', 'Multidispinary');

//admin data here

INSERT INTO user (user_id, F_name, L_name, Address, phone_number, dob, email, gender, dept_id) VALUES
('ADM/1001', 'Aravinda', 'Nissankaarachchi', '1 University St', 777111111, '1980-01-01', 'admin.user@example.com', 'M', NULL);

//Update

INSERT INTO user (user_id, F_name, L_name, Address, phone_number, dob, email, gender, dept_id) VALUES
('ADM/1001', 'Aravinda', 'Nissankaarachchi', '1 University St', 777111111, '1980-01-01', 'admin.user@example.com', 'M', NULL);

//add lecture data

INSERT INTO user (user_id, F_name, L_name, Address, phone_number, dob, email, gender, dept_id) VALUES
('LEC/1001', 'Kavindu', 'Perera', 'Colombo 05', 771234567, '1985-03-12', 'kavindu.perera@uni.lk', 'M', 'D001'),
('LEC/1002', 'Nimesha', 'Silva', 'Galle', 772345678, '1987-06-21', 'nimesha.silva@uni.lk', 'F', 'D004'),
('LEC/1003', 'Tharindu', 'Wijesinghe', 'Kandy', 773456789, '1984-11-05', 'tharindu.wije@uni.lk', 'M', 'D004'),
('LEC/1004', 'Sachini', 'Fernando', 'Kurunegala', 774567890, '1990-01-15', 'sachini.fernando@uni.lk', 'F', 'D001'),
('LEC/1005', 'Isuru', 'Jayasinghe', 'Matara', 775678901, '1986-07-19', 'isuru.j@uni.lk', 'M', 'D002'),
('LEC/1006', 'Dinithi', 'Karunaratne', 'Negombo', 776789012, '1988-09-30', 'dinithi.karu@uni.lk', 'F', 'D001'),
('LEC/1007', 'Chathura', 'Ranasinghe', 'Jaffna', 777890123, '1983-05-25', 'chathura.r@uni.lk', 'M', 'D001'),
('LEC/1008', 'Harshani', 'Bandara', 'Anuradhapura', 778901234, '1991-12-03', 'harshani.b@uni.lk', 'F', 'D001');
